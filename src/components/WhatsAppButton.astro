---
interface Props {
  /** Número en formato internacional sin + ni espacios. Ej: 5491112345678 */
  phone: string;
  /** Mensaje inicial opcional */
  message?: string;
  /** Posición: 'br' (default), 'bl', 'tr', 'tl' */
  position?: 'br' | 'bl' | 'tr' | 'tl';
  /** Mostrar etiqueta de texto (útil en desktop) */
  label?: string;
}

const {
  phone,
  position = 'br',
  label
} = Astro.props;

const href = `https://wa.me/${phone}`;
---

<style>
  :root{
    --wa-size: 56px;                /* diámetro del botón */
    --wa-bg: #25D366;
    --wa-ring: 3px;                 /* grosor del aro blanco */
    --wa-icon-pad: 8px;             /* aire entre aro e ícono */
    --wa-shadow: 0 10px 25px rgba(37,211,102,.35);
    --wa-bottom: calc(16px + env(safe-area-inset-bottom));
    --wa-side: calc(16px + env(safe-area-inset-right));
  }

  .wa-fab{
    position: fixed;
    z-index: 9999;
    bottom: var(--wa-bottom);
    right: var(--wa-side);
    display: inline-flex;
    align-items: center;
    gap: .6rem;
    text-decoration: none;
    color: #fff;
    font-weight: 600;
    line-height: 1;
    background: var(--wa-bg);
    border-radius: 9999px;
    box-shadow: var(--wa-shadow);
    -webkit-tap-highlight-color: transparent;
  }

  /* Variante con texto (píldora) */
  .wa-fab.pill{
    box-sizing: border-box;
    padding: .5rem .9rem;
    min-height: var(--wa-size);
  }

  /* Variante solo ícono (círculo con aro) */
  .wa-fab.circle{
    width: var(--wa-size);
    height: var(--wa-size);
    box-sizing: border-box;
    padding: calc(var(--wa-icon-pad) + var(--wa-ring));
    justify-content: center;
    align-items: center;
    box-shadow: var(--wa-shadow), inset 0 0 0 var(--wa-ring) #fff;
  }

  /* El SVG ocupa el área disponible y no se corta */
  .wa-fab svg{
    display: block;
    width: 100%;
    height: 100%;
    fill: #fff; /* ícono blanco */
  }

  .wa-fab .label{
    white-space: nowrap;
    font-size: 0.95rem;
  }

  /* Variantes de posición */
  .wa-fab.bl{ left: var(--wa-side); right: auto; }
  .wa-fab.tr{ top: 16px; bottom: auto; }
  .wa-fab.tl{ top: 16px; bottom: auto; left: var(--wa-side); right: auto; }

  /* Hover/focus */
  @media (hover:hover){
    .wa-fab:hover{ filter: brightness(1.05); transform: translateY(-1px); }
  }
  .wa-fab:focus-visible{
    outline: 3px solid rgba(37,211,102,.6);
    outline-offset: 3px;
  }

  /* Respeta preferencias del usuario */
  @media (prefers-reduced-motion: reduce){
    .wa-fab{ transition: none; }
  }
</style>

<a
  href={href}
  class={`wa-fab ${position} ${label ? 'pill' : 'circle'}`}
  target="_blank"
  rel="noopener noreferrer nofollow"
  aria-label="Abrir chat de WhatsApp"
>
  <!-- Ícono WhatsApp (SVG) -->
  <svg viewBox="0 0 32 32" aria-hidden="true">
    <path d="M19.11 17.04c-.29-.16-1.69-.91-1.95-1.02-.26-.1-.45-.16-.64.16-.19.32-.73 1.02-.9 1.23-.17.21-.33.24-.62.08-.29-.16-1.21-.44-2.31-1.41-.85-.75-1.42-1.68-1.59-1.96-.17-.28-.02-.43.13-.59.13-.13.29-.33.43-.5.14-.17.19-.29.29-.49.1-.21.06-.37-.03-.53-.08-.16-.64-1.55-.88-2.12-.23-.56-.47-.49-.64-.49-.16 0-.35-.02-.54-.02s-.49.07-.75.37c-.26.29-1 1-1 2.44s1.02 2.83 1.16 3.03c.14.19 2.01 3.07 4.87 4.31.68.29 1.21.46 1.62.59.68.22 1.3.19 1.79.11.55-.08 1.69-.69 1.93-1.35.24-.66.24-1.22.17-1.34-.07-.12-.26-.19-.55-.35zM16.02 3.2c-7.09 0-12.84 5.64-12.84 12.6 0 2.49.75 4.79 2.04 6.71L3.2 28.8l6.53-2.14c1.86 1.02 4 1.61 6.29 1.61 7.09 0 12.84-5.64 12.84-12.6S23.11 3.2 16.02 3.2zm0 22.9c-2.16 0-4.16-.66-5.82-1.79l-.42-.27-3.88 1.27 1.27-3.77-.29-.46c-1.2-1.84-1.9-3.95-1.9-6.28 0-6.33 5.25-11.46 11.72-11.46s11.72 5.14 11.72 11.46-5.25 11.46-11.72 11.46z"/>
  </svg>
  {label && <span class="label">{label}</span>}
</a>
